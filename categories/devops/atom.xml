<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: devops | KABLAMO]]></title>
  <link href="http://blog.kablamo.org/categories/devops/atom.xml" rel="self"/>
  <link href="http://blog.kablamo.org/"/>
  <updated>2014-03-25T22:40:12-04:00</updated>
  <id>http://blog.kablamo.org/</id>
  <author>
    <name><![CDATA[Eric Johnson]]></name>
    <email><![CDATA[kablamo@kablamo.org]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Anyenv + Plenv + Carton]]></title>
    <link href="http://blog.kablamo.org/2013/11/25/plenv/"/>
    <updated>2013-11-25T00:00:00-05:00</updated>
    <id>http://blog.kablamo.org/2013/11/25/plenv</id>
    <content type="html"><![CDATA[<p>Recently I started breaking out of my Perl-only isolation bubble and dabbling
with other languages. I was surprised how easy and comfortable other languages
are. I think its because these days good ideas spread from one language to the
next incredibly fast. Even in a new language when I reach for a tool I can
usually find some Perl technology analogue.</p>

<p>For example, I&rsquo;ve been a perlbrew person for a long time and it has served me
well.  Ruby has its own version of perlbrew called rbenv which is pretty great.
But actually it seems every language has a clone of rbenv.</p>

<ul>
<li>Python has pyenv.</li>
<li>PHP has phpenv.</li>
<li>Node has ndenv.</li>
<li>Java has jenv.</li>
<li>Perl has plenv.</li>
</ul>


<p>So I thought, what the heck &mdash; lets try that out.  The nice thing
is all the envs have pretty much the same command line options and the same
approach to managing dependencies.  I thought it might be calming and soothing
for my brain to have one way of doing things.</p>

<p>I found <a href="https://github.com/riywo/anyenv">Anyenv</a> just a second ago as I was
writing this.  It claims it will manage all my envs. Looks like brilliant
stuff. Fortune favors the bold. (I eat danger for breakfast.)  I&rsquo;ll try it.</p>

<pre><code>git clone https://github.com/riywo/anyenv ~/.anyenv
echo 'export PATH="$HOME/.anyenv/bin:$PATH"' &gt;&gt; ~/.my_profile
echo 'eval "$(anyenv init -)"'               &gt;&gt; ~/.my_profile
exec bash -l
anyenv install rbenv    # ruby
anyenv install plenv    # perl
anyenv install pyenv    # python
anyenv install phpenv   # php
anyenv install ndenv    # nodejs
anyenv install denv     # dunno
anyenv install jenv     # java
exec bash -l            # &lt;-- useful trick btw
anyenv versions
</code></pre>

<p>Ok now I have all the envs.  But I want to actually do some work with plenv.
Lets see if I can do that.</p>

<pre><code>plenv install --list  # list all the potential perl versions you can use
plenv install 5.19.6  # install perl v5.19.6
plenv rehash          # reload the shell environment with the new perl
plenv global 5.19.6   # use v5.19.6 everywhere by default
plenv local  5.19.6   # use v5.19.6 in this directory for this project
plenv install-cpanm   # install cpanm for this version of perl
plenv rehash          #
plenv which cpanm     # see where cpanm is installed. should be ~/.anyenv
</code></pre>

<p>Now I will install the dependencies for my project.  I will manage them with
<a href="https://metacpan.org/pod/Carton">Carton</a>.</p>

<pre><code>cpanm Carton          # install carton for this version of perl
plenv list-modules
</code></pre>

<p>At this point I need to create a <code>cpanfile</code>.  There are all kinds of cool
things you can do in this file, but with your permision I will begin with baby
steps.  Here is mine cpanfile for now:</p>

<pre><code>requires "Catalyst";
requires "Plack";
requires "DBD::SQLite";
</code></pre>

<p>And then I run carton to install these modules locally into local/lib/perl5.</p>

<pre><code>carton               # install all the dependencies from the cpanfile
ls local/lib/perl5/  # see all the new modules installed here
plenv list-modules   # see mountains of installed stuff
cd /tmp
plenv list-modules   # see nothing installed except Carton
</code></pre>

<p>Notice that a carton.snapshot file was created.  If I look inside, I can see a
list of all my project dependencies, and all their dependencies, etc all the
way down to the first turtle &mdash; AND there are version numbers for everything.</p>

<pre><code># carton snapshot format: version 1.0
DISTRIBUTIONS
Apache-LogFormat-Compiler-0.13
  pathname: K/KA/KAZEBURO/Apache-LogFormat-Compiler-0.13.tar.gz
    provides:
      Apache::LogFormat::Compiler 0.13
    requirements:
      CPAN::Meta 0
      CPAN::Meta::Prereqs 0
      Module::Build 0.38
...blah biddee blah etc...
</code></pre>

<p>I can add <code>cpanfile</code> and <code>cpanfile.snapshot</code> to my git repo.  Now when I deploy
or share the code, the user at the destination can run Carton and they will end
up with the exact dependencies with the exact same version numbers I had. This
way I can be sure my code will run as successfully for them as it did for me.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Monit - How to know when your web site is down]]></title>
    <link href="http://blog.kablamo.org/2013/11/24/monit/"/>
    <updated>2013-11-24T00:00:00-05:00</updated>
    <id>http://blog.kablamo.org/2013/11/24/monit</id>
    <content type="html"><![CDATA[<p>If your website goes down, you want to find out fast.  There are a few ways to
accomplish this, but I&rsquo;m using <a href="http://mmonit.com/monit">monit</a>.  Monit is a
mature unix monitoring daemon and it gives me the ability not only get alerts
but to restart services that go down.</p>

<p>Monit has lotsa power and options and you can read about all of them on
the man page.  Or if you don&rsquo;t want to mess around with that you can pay them
for a <a href="https://mmonit.com/screenshots/">pretty web admin interface</a> and some
phone/tablet apps for a one time fee of â‚¬ 65.  Another simpler and I think less
powerful option is <a href="http://monitis.com/?affiliate=1303230640">monitor.us</a>.</p>

<p>I don&rsquo;t want to pay.  So I installed monit like this:</p>

<pre><code>apt-get install monit
</code></pre>

<p>The configuration file for monit lives at <code>/etc/monit/monitrc</code>.  You probably
don&rsquo;t need to bother with that.  When monit runs, it looks in
<code>/etc/monit/conf.d</code> and executes any scripts it finds in there.  Like many
people I&rsquo;m running nginx in front of my Starman web apps.  So I want monitor
both of those processes.</p>

<p>Here is how to do that.  Created a script named <code>/etc/monit/confd/nginx</code>:</p>

<pre><code>check process nginx with pidfile /var/run/nginx.pid

    start program = "/etc/init.d/nginx start"
    stop  program = "/etc/init.d/nginx stop"

    alert kablamo@example.com with mail-format {
           from: monit@example.com
        subject: monit alert: $SERVICE $EVENT $DATE
        message: $DESCRIPTION
    }

    if failed port 80 protocol HTTP
        request /
        with timeout 7 seconds
        then restart
</code></pre>

<p>Then create a second script named <code>/etc/monit/conf.d/mywebapp</code>.  Its very
similar.  This assumes you are running your web app as the user <code>web</code> on
localhost port 22222.</p>

<pre><code>check process mywebapp with pidfile /var/run/mywebapp.pid

    start program = "/etc/init.d/mywebapp start" as uid web and gid web
    stop  program = "/etc/init.d/mywebapp stop"  as uid web and gid web

    alert kablamo@example.com with mail-format {
           from: monit@example.com
        subject: monit alert: $SERVICE $EVENT $DATE
        message: $DESCRIPTION
    }

    if failed port 22222 protocol HTTP
        request /
        with timeout 7 seconds
        then restart
</code></pre>

<p>With these scripts, anytime your processes disappear or stop working you will
get email and monit will try to restart them.</p>

<p>But I&rsquo;m paranoid.  So I created a third monit script to do an end to end test in case
something ever gets misconfigured somewhere. <code>/etc/monit/conf.d/end2end</code>:</p>

<pre><code>check host networthify.com with address 71.19.156.131

    alert kablamo@example.com with mail-format {
           from: monit@monit@example.com
        subject: monit alert: $SERVICE $EVENT $DATE
        message: $DESCRIPTION
    }

    if failed port 80 protocol HTTP
        request /
        with timeout 9 seconds
        then alert
</code></pre>

<p>Suggestions for improvment?</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Devops with Rex]]></title>
    <link href="http://blog.kablamo.org/2013/11/22/rex/"/>
    <updated>2013-11-22T00:00:00-05:00</updated>
    <id>http://blog.kablamo.org/2013/11/22/rex</id>
    <content type="html"><![CDATA[<p>I have recently been playing with <a href="http://www.rexify.org/">Rex</a> and wanted to
write down some of my initial thoughts.</p>

<p>Rex is a devops tool that helps you manage your servers.  Its similar to
Puppet Lab&rsquo;s <a href="http://puppetlabs.com/mcollective">mcollective</a> tool or
<a href="http://www.ansibleworks.com/docs/">ansible</a>.  You can easily run commands on
your entire fleet of boxen or just on certain subgroups.  And you can run
them in parallel which saves you giant baskets of time.</p>

<p>The big advantage for People Who Prefer Perl (PWPP) is that Rex is written and
configured with Perl. So for the most part you don&rsquo;t need to spend a lot of time
learning yet another DSL.</p>

<p>Another happy positive is that you don&rsquo;t need to install any software on your
servers. Installation is simple:</p>

<pre><code>$ apt-get install libssh2-1-dev
$ cpanm Rex
</code></pre>

<p>Configuration is also simple &mdash; at least if you know Perl.  The
Rex configuration file is named &lsquo;Rexfile&rsquo; and its syntax is Perl with some
extra Rexy sugar methods thrown in. And I feel the sugar and general API for
Rex is fairly well done.  Here is an example Rexfile:</p>

<pre><code># Configure the default user and your ssh keys.  The default user can be
# overridden on the command line with the -u option.
user "joe";
private_key "/home/joe/.ssh/id_rsa";
public_key "/home/joe/.ssh/id_rsa.pub";
key_auth;

# Cofigure server groups
group prod =&gt; "webserver", "mailserver", "dbserver";
group dev  =&gt; "pancake[1-3]", "narwhale[1-3]", "honeybadger[1-3]";

# Run commands in parallel on up to 100 servers at one time.  This can be
# overridden on the command line with the -t option.
parallelism 100;

# Create tasks.  This task runs against all servers by default.  This can
# be overridden on the command line with the -G or -H options.
task 'uptime', group =&gt; 'all', sub {
    my $output = run "uptime";
    say $output;
};
</code></pre>

<p>You can see that Perl&rsquo;s &lsquo;say&rsquo; command is available by default.  &lsquo;run&rsquo; is a Rex
sugar method which accepts a shell command and returns the output &mdash; similar
to Capture::Tiny.</p>

<p>Here is a command line example which runs the &lsquo;uptime&rsquo; task as the &lsquo;root&rsquo; user
on each server in the &lsquo;dev&rsquo; group:</p>

<pre><code>$ rex -G dev -u root uptime
    pancake1:  16:42:05 up 221 days,  9:49,  1 user,  load average: 0.00, 0.00, 0.00
   narwhale2:  16:42:05 up 8 days,  3:28,  4 users,  load average: 0.00, 0.00, 0.00
   narwhale3:  16:42:05 up 17 days,  3:57,  2 users,  load average: 0.01, 0.01, 0.00
honeybadger1:  16:42:05 up 80 days,  3:29,  1 user,  load average: 0.09, 0.06, 0.01
    pancake3:  16:42:05 up 137 days,  7:49,  1 user,  load average: 0.00, 0.00, 0.00
   narwhale1:  16:42:05 up 65 days,  5:30,  2 users,  load average: 0.46, 0.41, 0.37
honeybadger3:  16:42:04 up 15 days,  4:49,  1 user,  load average: 2.00, 2.00, 2.00
    pancake2:  16:42:04 up 1 day,  2:23,  3 users,  load average: 1.38, 1.35, 1.30
honeybadger2:  16:42:05 up 39 days,  1:24,  1 user,  load average: 0.08, 0.06, 0.01
</code></pre>

<p>Rex is fantastic for ad-hoc commands.  But it also has a great set of libraries
for doing much more like installing debian packages, user management,
virtualization, and managing EC2 boxes.  I have to say I&rsquo;m deeply attracted to
its simplicity &mdash; especially after dealing with Puppet&rsquo;s complicated and weird
DSL.</p>

<p>If anyone uses Rex to manage more than 50 servers, I would love to get in touch
with you and ask a few questions.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Down a rabbit hole - Docker]]></title>
    <link href="http://blog.kablamo.org/2013/11/13/docker/"/>
    <updated>2013-11-13T00:00:00-05:00</updated>
    <id>http://blog.kablamo.org/2013/11/13/docker</id>
    <content type="html"><![CDATA[<p>I have been in a rabbit hole for the last week.  I started looking at
<a href="http://www.docker.io/">Docker</a>.</p>

<p>Its a really interesting project that all the hosting providers seem to be
moving towards.  Its helpful at first to think of Docker as a really fast and
small virtual machine.  You can put an operating system in a virtual machine,
setup all the dependencies and permissions, and then configure and install your
app.  Its encapsulates your web app and makes it easy to move around.
Thats what docker does too except a docker container is an operating system
primitive &ndash; an <a href="http://linuxcontainers.org/">LXC</a>.  Which means its much faster
and smaller than a virtual machine and that makes it much easier to work with.</p>

<p>Docker also has a builtin version control system.  You can install a base
operating system like Ubuntu in your container and then commit that change.
Then you can install some dependencies and commit that change.  This commit
history also allows you to reuse different commits across different containers.</p>

<p>Docker also has builtin deployment that allows you to push your containers to
public (or private) repositories similar to CPAN or Ruby gems or pypi.</p>

<p>But I said this was a rabbit hole.  Because when I started playing with Docker
I realized its written in Go.  So I started learning <a href="http://golang.org/">Go</a>.
More on that tomorrow.</p>

<pre style="font: 4px/2px monospace; color: #333; background: transparent; border: 0px; border-radius: 0; box-shadow: 0 0 0 0;">





                                                              '''''''''''';
                                                              '''''''''''';
                                                              ''::;;::;;:';
                                                              ''::''::'':';
                                                              ''::''::'':';
                                                              ''::''::'':';
                                                              ''::''::'':';
                                                              ''::''::'':';
                                                              ''::''::'':';
                                                              ''::''::'':';
                                         ''''''''''''''''''''''':::::::::';
                                         ''''''''''''''''''''''''''''''''';                          ''
                                         '':::::::::':::::::::;':::::::::';                         ''''.
                                         '':;';:''::':'::''::';'::''::'':';                         '':'',
                                         '':;';:''::':'::''::';'::''::'':';                        '':::''`
                                         '':;';:''::':'::''::';'::''::'':';                        ''::::''
                                         '':;';:''::':'::''::';'::''::'':';                        ';:::::''
                                         '':;';:''::':'::''::';'::''::'':';                       ,'::::::''.
                                         '':;';:''::':'::''::';'::''::'':';                       ;':::::::''
                                         '':;';:''::':'::''::';'::''::'':';                       '':::::::;'
                                         '':::::::::':::::::::;':::::::::';                       ''::::::::';
                               ''''''''''''''''''''''''''''''''''''''''''''''''''''''             ''::::::::'' `,;'':.
                               '':::::::::':::::::::';::::::::;':::::::::':::::::::''             ;'::::::::'''''''''''':
                               '';:;';:'':':;'::''::';';:''::';'::''::'':':''::'':;''             `'::::::::''';::::::'''',
                               '';:;';:'':':;'::''::';';:''::';'::''::'':':''::'':;''              '':::::::::::::::::::;''
                               '';:;';:'':':;'::''::';';:''::';'::''::'':':''::'':;''              '':::::::::::::::::::;';
                               '';:;';:'':':;'::''::';';:''::';'::''::'':':''::'':;''              .';::::::::::::::::::''
                               '';:;';:'':':;'::''::';';:''::';'::''::'':':''::'':;''               '':::::::::::::::::''
                               '';:;';:'':':;'::''::';';:''::';'::''::'':':''::'':;''               `'':::::::::::::::''.
                               '';:;';:'':':;'::''::';';:''::';'::''::'':':''::'':;''             .'''::::::::::::::'''`
                               '';:;';:'':':;'::;'::';';:''::';'::;'::';:':''::'':;''          .'''''::::::::::::'''''
                      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''';:::::::''''''''''
                      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''';:::::::::::''''';.
                      '':::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::''
                      '':::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::''
                      ''::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::''
                      '':::::::::::::::::::::::::::::::'::::::::::::::::::::::::::::::::::::::::::::::::''         ;
               ':     ''::::::::;;::::::::::::::::::::''':::::::::::::::::'':::::::::::::::::::::':::::''         ''
              '''',   ''::::::;'''':::::::::::::::::'''''';:::::::::::::'''''';::::::::::::::::;'''';::''       '''''
            '''''''''''';''''''''''''';::::::::;''''''''''''''::::::;'''''''''''''';::::::::'''''''''''';,,:'''''''''',
        .'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''';
                      '';;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;''
                      ,';;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;''.
                       '';;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;''
                       '';;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;''
                       '';;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;''
                        '';;;;;;;;;;;;;;;;;;;;;;;;`.`;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;'':
                        '';;;;;;;;;;;;;;;;;;;;;;;`''``;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;'''
                        .'';;;;;;;;;;;;;;;;;;;;;;`'''`;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;'''
                         '';;;;;;;;;;;;;;;;;;;;;;`'''`;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;'''
                         .'';;;;;;;;;;;;;;;;;;;;;;```;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;'''
                          '';;;;;;;;;;;;;;;;;''';;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;'''
                           '''''''''''''''''''';;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;'''
                           `''''''''''''';.````;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;'';
                            :';........`````````;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;'''`
                             ;''..........``````;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;'''
                              ;''..............``;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;''':
                               ;''................;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;''''
                                .'':...............;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;''''`
                                  '''...............;;;;;;;;;;;;;;;;;;;;;;;;;;;''''.
                                   :'''..............;;;;;;;;;;;;;;;;;;;;;;;'''''`
                                     ''''.............;;;;;;;;;;;;;;;;;;;''''''
                                       ;'''',...........;;;;;;;;;;;;;'''''''
                                         `'''''';:........;;;;'''''''''':
                                             :''''''''''''''''''''';.
                                                  `,:;;;;;;,.



                          .`
                         ''';                                             ''':
                         ''''                                             ''''
                         ''''                                             ''''
                         ''''                                             ''''
                         ''''                                             ''''
                         ''''                                             ''''
               ;'''''.   ''''         ;'''''.                '''''',      ''''     `':         ,''''''                 :'''
             '''''''''': ''''       '''''''''''           `'''''''''':    ''''    :'''       ,''''''''''            .'''''':
           :'''''''''''''''''     :'''''''''''''         ;''''''''''''    ''''   :''''      ''''''''''''';         '''''''':
          ;''''''''''''''''''    ;'''''''''''''''       ''''''''''''''    ''''  :'''''     ''''''''''''''''       '''''''''
         .'''''      ;'''''''   .'''''      ;'''''     :'''''      :',    '''' :'''''     ''''':      '''''.     ''''''
         '''';         ''''''   '''';         '''',    '''':              '''':'''''     ,''''         .''''    .''''`
        :''''           '''''  :''''           ''''   ;''''               '''''''''      ''''          ;''''    ''''`
        ''''            ;''''  ''''            ;'''   ''''                ''''''''       ''';         ''''''    ''''
        ''''             ''''  ''''             ''';  ''''                '''''''       ''''         ''''';    :'''
        '''.             ''''  '''.             ''''  '''.                ''''''        ''''        '''''.     ''''
        '''              ''''  '''              ''''  '''                 '''''         ''''      `'''''       ''''
        '''.             ''''  '''.             ''''  '''.                '''''.        ''''     ,'''''        ''''
        ''';             ''''  ''';             ''''  ''';                ''''''.       ''''    ;'''''         ''''
        ''''            ,''',  ''''            ,''',  ''''                '''''''.      `''':  ''''''          ''''
        ;''':           ''''   '''':           ''''   :''':               ''''''''`      '''' ''''';           ''''
         ''''`         '''''    ''''.         '''''    ''''.              '''''''''`     ,'''''''',            ''''
         :'''''       '''''     ;'''''       '''''     ;'''''       ;     '''' '''''`     '''''''`    :'       ''''
          ''''''',,;''''''`      ''''''',,:''''''`      ''''''';,;''''    ''''  '''''`     ''''''';;'''''      ''''
           ''''''''''''''.        ''''''''''''''`        '''''''''''''    ''''   '''''      '''''''''''''      ''''
            ;'''''''''''           ;'''''''''''           ''''''''''''    ''''    ''''`      '''''''''''`      ''''
              ;'''''''               ;'''''''               ''''''''`     .''`     '''         ;'''''',        `'':









</pre>

]]></content>
  </entry>
  
</feed>
