<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>HTTP::Request::AsCurl</title>
  <meta name="description" content="Today, on a whim, I released a module calledHTTP::Request::AsCurl toCPAN.  It converts an HTTP::Request object to a curl command.">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://blog.kablamo.org/2014/05/27/http-request-ascurl/">
  <link rel="alternate" type="application/rss+xml" title="kablamo" href="http://blog.kablamo.org/feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/"><span class="site-title-bold">kablamo</span></a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
          <a class="page-link" href="/about">About</a>
          <a class="page-link" href="/categories/perl">Perl</a>
          <a class="page-link" href="/categories/experiments">Experiments</a>
          <a class="page-link" href="/talks">Talks</a>
          <a class="page-link" href="/reading-list">What I'm reading</a>
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">HTTP::Request::AsCurl</h1>
    <p class="post-meta">
    
      <a href="/categories/perl">perl</a>&nbsp;
    
      <a href="/categories/code">code</a>&nbsp;
    
    &nbsp;&nbsp;
    2014-05-27
    </p>
  </header>

  <article class="post-content">
    <p>Today, on a whim, I released a module called
<a href="https://metacpan.org/pod/HTTP::Request::AsCurl">HTTP::Request::AsCurl</a> to
CPAN.  It converts an HTTP::Request object to a curl command.</p>

<pre><code>use HTTP::Request::Common;
use HTTP::Request::AsCurl;

my $request = POST('api.earth.defense/weapon1', { 
    target =&gt; 'mothership', 
    when   =&gt; 'now' 
});

say join "\n", $request-&gt;as_curl;
# curl --dump-header - -XPOST "api.earth.defense/weapon1" \
# --data 'target=mothership' \
# --data 'when=now'
</code></pre>

<p>It works by injecting the <code>as_curl()</code> method into the HTTP::Request namespace.
This must be a bad idea and probably not a great bit of code to rely on in a
production environment.  But it is pretty convenient syntax for debugging a
REST API and I couldn’t resist.  Thoughts, suggestions, criticism?</p>

<h1 id="update-2014-06-01---">– UPDATE (2014-06-01) –</h1>

<p>I released a new version which has a totally different user interface.  Here is
the new synopsis:</p>

<pre><code>use HTTP::Request::Common;
use HTTP::Request::AsCurl qw/as_curl/;

my $request = POST('api.earth.defense/weapon1', { 
    target =&gt; 'mothership', 
    when   =&gt; 'now' 
});

system as_curl($request);

print as_curl($request, pretty =&gt; 1, newline =&gt; "\n", shell =&gt; 'bourne');
# curl \
# --request POST api.earth.defense/weapon1 \
# --dump-header - \
# --data target=mothership \
# --data when=now
</code></pre>

<p>There are 2 major changes.</p>

<ol>
  <li>I’m no longer doing namespace injection.  I really liked the syntax, but it
was problematic and unnecessary.</li>
  <li>The old version returned a formatted array of strings which was 
not very useful.  The problem with a formatted string (as was helpfully
pointed out to me) is you have worry about stuff like newlines which
depends on the system you are targeting and shell escaping which depends on
the shell you are targeting.  This is a can of worms.  Hopefully this new
interface is an improvement.</li>
</ol>


  </article>


  <section>
    <div id="disqus_thread" aria-live="polite">
        <noscript>Please enable JavaScript to view the 
            <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
    </div>
  </section>


</div>


<script type="text/javascript">
      var disqus_shortname = 'kablamo';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.kablamo.org/2014/05/27/http-request-ascurl/';
        var disqus_url = 'http://blog.kablamo.org/2014/05/27/http-request-ascurl/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


      </div>
    </div>

    

  </body>

</html>
